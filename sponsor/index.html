<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="jamaljsr" />
    <meta
      name="description"
      content="Sponsor Polar to help builders ship Lightning apps faster. Choose a tier, add your handle (optional), and donate with Lightning or Bitcoin."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Become a Polar Sponsor</title>

    <link
      rel="shortcut icon"
      href="../images/favicon.ico"
      type="image/x-icon"
    />
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png" />

    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Noto+Sans+TC:300,400,500,700,900"
      rel="stylesheet"
    />

    <link href="../css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link href="../css/flaticon.css" rel="stylesheet" />
    <link href="../css/magnific-popup.css" rel="stylesheet" />
    <link href="../css/owl.carousel.min.css" rel="stylesheet" />
    <link href="../css/owl.theme.default.min.css" rel="stylesheet" />
    <link href="../css/animate.css" rel="stylesheet" />
    <link href="../css/main.css" rel="stylesheet" />
    <link href="../css/responsive.css" rel="stylesheet" />
  </head>

  <body class="sponsor-page">
    <div id="page" class="page">
      <!-- HEADER -->
      <header id="header" class="header">
        <nav
          class="navbar fixed-top navbar-expand-md navbar-light bg-tra hover-menu sponsor-nav"
        >
          <div class="container">
            <a href="../index.html#hero-2" class="navbar-brand logo-black">
              <img
                src="../images/logo.png"
                width="120"
                height="30"
                alt="Polar logo"
              />
            </a>

            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-bar-icon"><i class="fas fa-bars"></i></span>
            </button>

            <div id="navbarSupportedContent" class="collapse navbar-collapse">
              <ul class="navbar-nav ml-auto">
                <li class="nav-item nl-simple">
                  <a class="nav-link" href="../index.html#hero-2">Home</a>
                </li>
                <li class="nav-item nl-simple">
                  <a class="nav-link" href="../index.html#content-1"
                    >Features</a
                  >
                </li>
                <li class="nav-item nl-simple">
                  <a class="nav-link" href="../index.html#reviews-2">Reviews</a>
                </li>
                <li class="nav-item nl-simple active">
                  <a class="nav-link" href="/sponsor/">Sponsor</a>
                </li>
              </ul>

              <span class="navbar-text white-color">
                <a
                  href="../index.html#hero-2"
                  class="btn btn-primary-color tra-black-hover"
                  >Download</a
                >
              </span>
            </div>
          </div>
        </nav>
      </header>
      <!-- END HEADER -->

      <!-- HERO -->
      <section id="sponsor-hero" class="bg-lightgrey">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-6">
              <div class="hero-txt">
                <h1 class="h2-sm steelblue-color">Support the Polar project</h1>
                <p class="p-md">
                  Polar stays fast and free thanks to the contributions from the
                  community. Thank you for helping builders ship Lightning apps
                  faster. If youâ€™d like to join them, add your handle and weâ€™ll
                  direct you to a quick, built-in payment page for a Lightning
                  or on-chain donation.
                </p>
                <div class="hero-benefits-wrap">
                  <ul class="hero-benefits">
                    <li>Every sponsor appears on the wall by tier</li>
                    <li>
                      Accepts Bitcoin, Lightning, and USD via GitHub Sponsors
                    </li>
                    <li>GitHub, Twitter, or Nostr handles for recognition</li>
                    <li>Code contributors recognized for their work</li>
                  </ul>
                </div>
                <a
                  class="btn btn-primary-color tra-black-hover"
                  href="#sponsor-flow"
                  >Donate BTC</a
                >
                <a
                  class="btn btn-outline-secondary d-inline-block ml-2"
                  href="https://github.com/sponsors/jamaljsr"
                  target="_blank"
                  rel="noopener"
                  >Donate USD</a
                >
                <p class="mt-2 mb-0 grey-color">
                  Prefer to contribute code? Visit the
                  <a
                    href="https://github.com/jamaljsr/polar"
                    target="_blank"
                    rel="noopener"
                    >Polar repo</a
                  >.
                </p>
              </div>
            </div>
            <div class="col-lg-5 offset-lg-1">
              <div class="sponsor-hero-card">
                <div class="sponsor-hero-label">Bitcoin + Lightning</div>
                <h4 class="h4-sm mt-10">
                  Fuel development, testing, and support
                </h4>
                <p class="mb-0">
                  Sponsorships fund: faster releases, updated node images, docs,
                  and community help for Lightning builders.
                </p>
                <div class="sponsor-hero-meta mt-20">
                  <div>
                    <span class="meta-label">Recognition</span>
                    <p class="mb-0">On this page and homepage</p>
                  </div>
                  <div>
                    <span class="meta-label">Payments</span>
                    <p class="mb-0">Bitcoin, Lightning, and USD</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- END HERO -->

      <!-- SPONSOR FLOW -->
      <section
        id="sponsor-flow"
        class="wide-80 sponsor-flow division bg-white b-top"
      >
        <div class="container">
          <div class="row">
            <div class="col-lg-6">
              <div class="section-title mb-30">
                <h3 class="h3-md steelblue-color">Pick a Tier</h3>
                <p class="p-md">
                  Custom amounts map to the closest tier automatically.
                </p>
              </div>
              <div class="tier-grid">
                <div class="tier-card active" data-tier="supporter">
                  <div class="tier-label">Supporter</div>
                  <p class="tier-amount">100K sats</p>
                  <p class="tier-copy mb-0">
                    Listed in the Supporters section.
                  </p>
                </div>
                <div class="tier-card" data-tier="backer">
                  <div class="tier-label">Backer</div>
                  <p class="tier-amount">500K sats</p>
                  <p class="tier-copy mb-0">Listed in the Backers section.</p>
                </div>
                <div class="tier-card" data-tier="sponsor">
                  <div class="tier-label">Sponsor</div>
                  <p class="tier-amount">1M sats</p>
                  <p class="tier-copy mb-0">Listed in the Sponsors section.</p>
                </div>
                <div class="tier-card" data-tier="champion">
                  <div class="tier-label">Champion</div>
                  <p class="tier-amount">10M+ sats</p>
                  <p class="tier-copy mb-0">
                    Listed in Champions with prominent placement.
                  </p>
                </div>
              </div>
            </div>

            <div class="col-lg-5 offset-lg-1">
              <div class="contribute-card">
                <div class="contribute-card-header">
                  <h4 class="h4-sm mb-2">One-time BTC Donation</h4>
                  <p class="mb-0">
                    You'll be redirected to our payment page to obtain a
                    Lightning invoice or Bitcoin on-chain address.
                  </p>
                </div>

                <div class="form-group">
                  <label for="sats-amount">Amount (sats)</label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">âš¡</span>
                    </div>
                    <input
                      id="sats-amount"
                      type="text"
                      inputmode="numeric"
                      class="form-control"
                      value="100,000"
                    />
                  </div>
                </div>

                <div class="form-group">
                  <div class="custom-control custom-switch recognition-toggle">
                    <input
                      type="checkbox"
                      class="custom-control-input"
                      id="recognition-enabled"
                    />
                    <label
                      class="custom-control-label"
                      for="recognition-enabled"
                      >Add me to the Sponsors list
                    </label>
                  </div>
                </div>

                <div id="recognition-fields" class="recognition-fields" hidden>
                  <div class="form-group">
                    <label>Platform</label>
                    <div class="btn-group platform-toggle" role="group">
                      <button
                        type="button"
                        class="btn btn-outline-secondary active"
                        data-platform="github"
                      >
                        GitHub
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        data-platform="twitter"
                      >
                        Twitter / X
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        data-platform="nostr"
                      >
                        Nostr
                      </button>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="username">Handle</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="platform-prefix"
                          >@</span
                        >
                      </div>
                      <input
                        id="username"
                        type="text"
                        class="form-control"
                        placeholder="username"
                        aria-describedby="platform-prefix"
                      />
                    </div>
                    <small class="form-text text-muted">
                      Shown publicly on the sponsor wall.
                    </small>
                  </div>
                </div>

                <div class="contribute-actions">
                  <a
                    id="pay-button"
                    class="btn btn-primary-color tra-black-hover btn-wide"
                    href="#"
                    >Donate</a
                  >
                </div>
                <p id="donation-error" class="text-danger mt-2 mb-0" hidden></p>

                <p class="form-note mb-0 grey-color">
                  After confirming payment, we'll add you to the matching tier
                  on this page and highlight top sponsors on the homepage.
                </p>

                <p class="form-note mt-10 grey-color">
                  Prefer fiat? Use the
                  <a
                    href="https://github.com/sponsors/jamaljsr"
                    target="_blank"
                    rel="noopener"
                    >GitHub Sponsors</a
                  >
                  page.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- END SPONSOR FLOW -->

      <!-- SPONSOR LISTS -->
      <section id="sponsor-lists" class="wide-80 sponsor-lists division">
        <div class="container">
          <div class="row">
            <div class="col-lg-10 offset-lg-1 section-title">
              <h3 class="h3-md steelblue-color">
                Sponsor &amp; Contributor Recognition
              </h3>
              <p class="p-md">
                Huge thanks to everyone helping Polar run. Sponsors and code
                contributors are recognized below.
              </p>
            </div>
          </div>

          <div class="sponsor-level">
            <div class="sponsor-level-header">
              <h4 class="h4-sm mb-1">Sponsors</h4>
              <p id="sponsors-subtitle" class="mb-0">
                New sponsors will appear here.
              </p>
            </div>
            <div class="sponsor-level-body">
              <div id="sponsors-empty" class="row">
                <div class="col-lg-8">
                  <div class="sponsor-empty">
                    <div class="sponsor-empty-icon" aria-hidden="true">
                      <i class="fas fa-star"></i>
                    </div>
                    <div class="sponsor-empty-body">
                      <div class="sponsor-name">No sponsors yet</div>
                      <p class="sponsor-note mb-2">
                        Be the first sponsor and help fund Polarâ€™s roadmap.
                      </p>
                      <a
                        class="btn btn-primary-color tra-black-hover btn-sm"
                        href="#sponsor-flow"
                        >Become a sponsor</a
                      >
                    </div>
                  </div>
                </div>
              </div>

              <div class="sponsor-tiers">
                <div
                  id="champions-section"
                  class="sponsor-tier tier-champion"
                  hidden
                >
                  <div class="sponsor-tier-header">
                    <div class="sponsor-tier-pill">Champions</div>
                    <div class="sponsor-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="champions-grid" class="sponsor-grid"></div>
                </div>

                <div
                  id="sponsors-section"
                  class="sponsor-tier tier-sponsor"
                  hidden
                >
                  <div class="sponsor-tier-header">
                    <div class="sponsor-tier-pill">Sponsors</div>
                    <div class="sponsor-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="sponsors-grid" class="sponsor-grid"></div>
                </div>

                <div
                  id="backers-section"
                  class="sponsor-tier tier-backer"
                  hidden
                >
                  <div class="sponsor-tier-header">
                    <div class="sponsor-tier-pill">Backers</div>
                    <div class="sponsor-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="backers-grid" class="sponsor-grid"></div>
                </div>

                <div
                  id="supporters-section"
                  class="sponsor-tier tier-supporter"
                  hidden
                >
                  <div class="sponsor-tier-header">
                    <div class="sponsor-tier-pill">Supporters</div>
                    <div class="sponsor-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="supporters-grid" class="sponsor-grid"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="sponsor-level">
            <div class="sponsor-level-header">
              <h4 class="h4-sm mb-1">Code contributors</h4>
              <p class="mb-3">
                Recognizing contributors whose code keeps Polar fast, stable,
                and useful for the Lightning community.
              </p>
            </div>
            <div id="contributors-list" class="row contributor-grid"></div>
          </div>
        </div>
      </section>
      <!-- END SPONSOR LISTS -->
    </div>
    <!-- END PAGE -->

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jquery.easing.js"></script>
    <script src="../js/wow.js"></script>
    <script src="../js/custom.js?v3.3.0"></script>
    <script>
      new WOW().init();
    </script>
    <script>
      (() => {
        const tierMinimums = {
          supporter: 100000,
          backer: 500000,
          sponsor: 1000000,
          champion: 10000000,
        };

        const platformPlaceholders = {
          github: 'username',
          twitter: 'handle',
          nostr: 'npub1...',
        };

        const tierCards = document.querySelectorAll('.tier-card');
        const amountInput = document.getElementById('sats-amount');
        const platformButtons = document.querySelectorAll('[data-platform]');
        const platformPrefix = document.getElementById('platform-prefix');
        const usernameInput = document.getElementById('username');
        const payButton = document.getElementById('pay-button');
        const recognitionToggle = document.getElementById(
          'recognition-enabled'
        );
        const recognitionFields = document.getElementById('recognition-fields');
        const donationError = document.getElementById('donation-error');
        const contributorsList = document.getElementById('contributors-list');

        let selectedTier = 'supporter';
        let selectedPlatform = 'github';
        const apiParam = new URLSearchParams(window.location.search).get('api');
        const apiPort = '8787';
        const host = window.location.hostname;
        const isProdSite =
          host === 'lightningpolar.com' || host.endsWith('.lightningpolar.com');
        const apiBase =
          apiParam ||
          (isProdSite
            ? 'https://api.lightningpolar.com'
            : `${window.location.protocol}//${host}:${apiPort}`);

        const contributors = [
          {
            name: 'kelvinator07',
            url: 'https://github.com/kelvinator07',
            avatar: 'https://avatars.githubusercontent.com/u/37830553?v=4',
            year: '2024',
          },
          {
            name: 'Abdulkbk',
            url: 'https://github.com/Abdulkbk',
            avatar: 'https://avatars.githubusercontent.com/u/45062451?v=4',
            year: '2025',
          },
          {
            name: 'bolatovumar',
            url: 'https://github.com/bolatovumar',
            avatar: 'https://avatars.githubusercontent.com/u/1934678?v=4',
            year: '2021',
          },
          {
            name: 'Jem256',
            url: 'https://github.com/Jem256',
            avatar: 'https://avatars.githubusercontent.com/u/72874905?v=4',
            year: '2025',
          },
          {
            name: 'amovfx',
            url: 'https://github.com/amovfx',
            avatar: 'https://avatars.githubusercontent.com/u/45839100?v=4',
            year: '2023',
          },
          {
            name: 'torkelrogstad',
            url: 'https://github.com/torkelrogstad',
            avatar: 'https://avatars.githubusercontent.com/u/16610775?v=4',
            year: '2020',
          },
          {
            name: 'louneskmt',
            url: 'https://github.com/louneskmt',
            avatar: 'https://avatars.githubusercontent.com/u/38882571?v=4',
            year: '2022',
          },
          {
            name: 'ktecho',
            url: 'https://github.com/ktecho',
            avatar: 'https://avatars.githubusercontent.com/u/547169?v=4',
            year: '2022',
          },
          {
            name: 'uwla',
            url: 'https://github.com/uwla',
            avatar: 'https://avatars.githubusercontent.com/u/47862859?v=4',
            year: '2024',
          },
          {
            name: 'murtyjones',
            url: 'https://github.com/murtyjones',
            avatar: 'https://avatars.githubusercontent.com/u/708562?v=4',
            year: '2021',
          },
          {
            name: 'hsjoberg',
            url: 'https://github.com/hsjoberg',
            avatar: 'https://avatars.githubusercontent.com/u/3824379?v=4',
            year: '2022',
          },
          {
            name: 'Hakkadaikon',
            url: 'https://github.com/Hakkadaikon',
            avatar: 'https://avatars.githubusercontent.com/u/57866935?v=4',
            year: '2024',
          },
          {
            name: 'IgnacioPorte',
            url: 'https://github.com/IgnacioPorte',
            avatar: 'https://avatars.githubusercontent.com/u/62029630?v=4',
            year: '2025',
          },
          {
            name: 'porcupinenick',
            url: 'https://github.com/porcupinenick',
            avatar: 'https://avatars.githubusercontent.com/u/24903257?v=4',
            year: '2020',
          },
          {
            name: 'niteshbalusu11',
            url: 'https://github.com/niteshbalusu11',
            avatar: 'https://avatars.githubusercontent.com/u/84944042?v=4',
            year: '2022',
          },
          {
            name: 'hieblmi',
            url: 'https://github.com/hieblmi',
            avatar: 'https://avatars.githubusercontent.com/u/18631614?v=4',
            year: '2023',
          },
          {
            name: 'AdamuAbba',
            url: 'https://github.com/AdamuAbba',
            avatar: 'https://avatars.githubusercontent.com/u/48435816?v=4',
            year: '2025',
          },
          {
            name: 'cstenglein',
            url: 'https://github.com/cstenglein',
            avatar: 'https://avatars.githubusercontent.com/u/9399034?v=4',
            year: '2021',
          },
          {
            name: 'kaloudis',
            url: 'https://github.com/kaloudis',
            avatar: 'https://avatars.githubusercontent.com/u/1878621?v=4',
            year: '2020',
          },
          {
            name: 'federicobond',
            url: 'https://github.com/federicobond',
            avatar: 'https://avatars.githubusercontent.com/u/138426?v=4',
            year: '2019',
          },
          {
            name: 'Fideltodayy',
            url: 'https://github.com/Fideltodayy',
            avatar: 'https://avatars.githubusercontent.com/u/113513351?v=4',
            year: '2025',
          },
          {
            name: 'qustavo',
            url: 'https://github.com/qustavo',
            avatar: 'https://avatars.githubusercontent.com/u/1288313?v=4',
            year: '2021',
          },
          {
            name: 'NonsoAmadi10',
            url: 'https://github.com/NonsoAmadi10',
            avatar: 'https://avatars.githubusercontent.com/u/42790057?v=4',
            year: '2023',
          },
          {
            name: 'jcbrand',
            url: 'https://github.com/jcbrand',
            avatar: 'https://avatars.githubusercontent.com/u/683911?v=4',
            year: '2025',
          },
          {
            name: 'Jasonvdb',
            url: 'https://github.com/Jasonvdb',
            avatar: 'https://avatars.githubusercontent.com/u/5300488?v=4',
            year: '2020',
          },
          {
            name: 'halseth',
            url: 'https://github.com/halseth',
            avatar: 'https://avatars.githubusercontent.com/u/3765732?v=4',
            year: '2020',
          },
          {
            name: 'Jhoyola',
            url: 'https://github.com/Jhoyola',
            avatar: 'https://avatars.githubusercontent.com/u/42843554?v=4',
            year: '2023',
          },
          {
            name: 'lukechilds',
            url: 'https://github.com/lukechilds',
            avatar: 'https://avatars.githubusercontent.com/u/2123375?v=4',
            year: '2020',
          },
          {
            name: 'Mshehu5',
            url: 'https://github.com/Mshehu5',
            avatar: 'https://avatars.githubusercontent.com/u/104724920?v=4',
            year: '2025',
          },
          {
            name: 'NehaK745',
            url: 'https://github.com/NehaK745',
            avatar: 'https://avatars.githubusercontent.com/u/64440607?v=4',
            year: '2021',
          },
          {
            name: 'ottosuess',
            url: 'https://github.com/ottosuess',
            avatar: 'https://avatars.githubusercontent.com/u/37940680?v=4',
            year: '2019',
          },
          {
            name: 'SeverinAlexB',
            url: 'https://github.com/SeverinAlexB',
            avatar: 'https://avatars.githubusercontent.com/u/8782386?v=4',
            year: '2023',
          },
          {
            name: 'valentinewallace',
            url: 'https://github.com/valentinewallace',
            avatar: 'https://avatars.githubusercontent.com/u/10647624?v=4',
            year: '2021',
          },
          {
            name: 'wbobeirne',
            url: 'https://github.com/wbobeirne',
            avatar: 'https://avatars.githubusercontent.com/u/649992?v=4',
            year: '2019',
          },
          {
            name: 'ramigs',
            url: 'https://github.com/ramigs',
            avatar: 'https://avatars.githubusercontent.com/u/44037130?v=4',
            year: '2023',
          },
          {
            name: 'git-sgmoore',
            url: 'https://github.com/git-sgmoore',
            avatar: 'https://avatars.githubusercontent.com/u/24982751?v=4',
            year: '2021',
          },
          {
            name: 'soonsouth',
            url: 'https://github.com/soonsouth',
            avatar: 'https://avatars.githubusercontent.com/u/163404563?v=4',
            year: '2024',
          },
          {
            name: 'zackypick',
            url: 'https://github.com/zackypick',
            avatar: 'https://avatars.githubusercontent.com/u/15138241?v=4',
            year: '2022',
          },
          {
            name: 'See all contributors',
            role: 'Add your name to the list',
            url: 'https://github.com/jamaljsr/polar/graphs/contributors',
            cta: true,
          },
        ];

        const formatAmount = (value) =>
          Number(value).toLocaleString('en-US', { maximumFractionDigits: 0 });

        const normalizeAmount = () => {
          const raw = parseInt(
            String(amountInput.value).replace(/,/g, '').trim(),
            10
          );
          const sanitized = Number.isFinite(raw) && raw > 1000 ? raw : 1000;
          amountInput.value = formatAmount(sanitized);
          return sanitized;
        };

        const updateTierFromAmount = () => {
          const currentAmount = normalizeAmount();
          const tiers = Object.keys(tierMinimums);
          let matchedTier = tiers[0];

          tiers.forEach((tier) => {
            if (currentAmount >= tierMinimums[tier]) {
              matchedTier = tier;
            }
          });

          selectedTier = matchedTier;
          tierCards.forEach((card) =>
            card.classList.toggle('active', card.dataset.tier === matchedTier)
          );

          return currentAmount;
        };

        const setTier = (tier) => {
          selectedTier = tier;
          const min = tierMinimums[tier];
          amountInput.value = formatAmount(min);

          tierCards.forEach((card) =>
            card.classList.toggle('active', card.dataset.tier === tier)
          );
        };

        const setPlatform = (platform) => {
          selectedPlatform = platform;
          platformButtons.forEach((btn) =>
            btn.classList.toggle('active', btn.dataset.platform === platform)
          );
          platformPrefix.textContent = platform === 'nostr' ? 'ðŸ”‘' : '@';
          usernameInput.placeholder = platformPlaceholders[platform];
        };

        const showError = (message) => {
          if (!donationError) return;
          donationError.hidden = !message;
          donationError.textContent = message || '';
        };

        const createIntent = async (includeIdentity = true) => {
          const amountSat = updateTierFromAmount();
          const username = usernameInput.value.trim();

          const payload = { amountSat };
          if (includeIdentity && username) {
            payload.platform = selectedPlatform;
            payload.username = username;
          }

          const res = await fetch(`${apiBase}/sponsor/intents`, {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify(payload),
          });

          const data = await res.json().catch(() => null);
          if (!res.ok) {
            throw new Error(data?.error?.message || 'Unable to start payment.');
          }

          if (!data?.intentId) {
            throw new Error('Unexpected response from server.');
          }

          return data.intentId;
        };

        const fetchSponsors = async () => {
          const res = await fetch(`${apiBase}/sponsors`, { method: 'GET' });
          if (!res.ok) return [];
          const data = await res.json().catch(() => null);
          return Array.isArray(data?.sponsors) ? data.sponsors : [];
        };

        const safeUrl = (value) => {
          try {
            const u = new URL(value);
            return u.protocol === 'https:' ? u.toString() : null;
          } catch {
            return null;
          }
        };

        const labelFromProfile = (profileUrl) => {
          try {
            const u = new URL(profileUrl);
            const last =
              u.pathname.split('/').filter(Boolean).pop() || u.hostname;
            return last.length > 22 ? `${last.slice(0, 22)}â€¦` : last;
          } catch {
            return 'Sponsor';
          }
        };

        const displayNameForSponsor = (sponsor) => {
          const username =
            sponsor && typeof sponsor.username === 'string'
              ? sponsor.username.trim()
              : '';
          if (username) {
            return username.length > 22
              ? `${username.slice(0, 22)}â€¦`
              : username;
          }

          const profileUrl = sponsor?.profileUrl;
          return typeof profileUrl === 'string'
            ? labelFromProfile(profileUrl)
            : 'Sponsor';
        };

        const renderSponsorTier = (
          gridEl,
          sponsors,
          tier,
          isChampion = false
        ) => {
          if (!gridEl) return;
          gridEl.innerHTML = '';

          const tierSponsors = sponsors.filter((s) => s?.tier === tier);
          if (!tierSponsors.length) return;

          tierSponsors.forEach((s) => {
            const profileUrl = safeUrl(s.profileUrl);
            const imageUrl = safeUrl(s.imageUrl);
            if (!profileUrl || !imageUrl) return;

            const tile = document.createElement('a');
            tile.className = `sponsor-tile tier-${tier}`;
            tile.href = profileUrl;
            tile.target = '_blank';
            tile.rel = 'noopener noreferrer';

            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = `${displayNameForSponsor(s)} avatar`;
            img.loading = 'lazy';
            img.referrerPolicy = 'no-referrer';

            const avatar = document.createElement('div');
            avatar.className = 'sponsor-avatar';

            const avatarInner = document.createElement('div');
            avatarInner.className = 'sponsor-avatar-inner';
            avatarInner.appendChild(img);
            avatar.appendChild(avatarInner);

            const namePill = document.createElement('div');
            namePill.className = 'sponsor-name-pill';
            namePill.textContent = displayNameForSponsor(s);

            avatar.appendChild(namePill);

            tile.appendChild(avatar);

            gridEl.appendChild(tile);
          });
        };

        const renderContributors = () => {
          if (!contributorsList) return;

          contributorsList.innerHTML = '';

          contributors.forEach(({ name, role, url, avatar, year, cta }) => {
            const col = document.createElement('div');
            col.className = 'col-6 col-lg-4';

            const tile = document.createElement(url ? 'a' : 'div');
            tile.className = `contributor-tile${cta ? ' cta' : ''}`;

            if (url) {
              tile.href = url;
              tile.target = '_blank';
              tile.rel = 'noopener';
            }

            const avatarEl = document.createElement('div');
            avatarEl.className = 'contributor-avatar';
            if (!cta && avatar) {
              const img = document.createElement('img');
              img.src = avatar;
              img.alt = `${name} avatar`;
              img.loading = 'lazy';
              img.referrerPolicy = 'no-referrer';
              img.onerror = () => {
                avatarEl.textContent = (name || '?').charAt(0).toUpperCase();
                img.remove();
              };
              avatarEl.appendChild(img);
            } else {
              avatarEl.textContent = (name || '?').charAt(0).toUpperCase();
            }

            const meta = document.createElement('div');

            const title = document.createElement('div');
            title.className = 'contributor-name';
            title.textContent = name;

            const subtitle = document.createElement('p');
            subtitle.className = 'contributor-role mb-0';
            subtitle.textContent = year
              ? `${year} ${role || 'Contributor'}`
              : role || 'Contributor';

            meta.appendChild(title);
            meta.appendChild(subtitle);

            tile.appendChild(avatarEl);
            tile.appendChild(meta);
            col.appendChild(tile);
            contributorsList.appendChild(col);
          });
        };

        tierCards.forEach((card) => {
          card.addEventListener('click', () => setTier(card.dataset.tier));
        });

        platformButtons.forEach((btn) => {
          btn.addEventListener('click', () =>
            setPlatform(btn.dataset.platform)
          );
        });

        amountInput.addEventListener('input', updateTierFromAmount);

        const updateRecognitionUI = () => {
          const enabled = Boolean(recognitionToggle?.checked);
          if (recognitionFields) recognitionFields.hidden = !enabled;
          if (!enabled && usernameInput) usernameInput.value = '';
        };

        recognitionToggle?.addEventListener('change', updateRecognitionUI);

        payButton.addEventListener('click', (event) => {
          event.preventDefault();
          showError('');
          payButton.classList.add('disabled');
          payButton.setAttribute('aria-disabled', 'true');

          createIntent(Boolean(recognitionToggle?.checked))
            .then((intentId) => {
              window.location.href = `/sponsor/pay/?intent=${encodeURIComponent(
                intentId
              )}`;
            })
            .catch((err) => {
              showError(err instanceof Error ? err.message : String(err));
              payButton.classList.remove('disabled');
              payButton.removeAttribute('aria-disabled');
            });
        });

        // Initialize defaults
        setTier(selectedTier);
        setPlatform(selectedPlatform);
        updateRecognitionUI();
        renderContributors();

        // Render sponsor wall from API (paid + published only)
        const championsGrid = document.getElementById('champions-grid');
        const sponsorsGrid = document.getElementById('sponsors-grid');
        const backersGrid = document.getElementById('backers-grid');
        const supportersGrid = document.getElementById('supporters-grid');

        const sponsorsSubtitle = document.getElementById('sponsors-subtitle');

        const sponsorsEmpty = document.getElementById('sponsors-empty');
        const championsSection = document.getElementById('champions-section');
        const sponsorsSection = document.getElementById('sponsors-section');
        const backersSection = document.getElementById('backers-section');
        const supportersSection = document.getElementById('supporters-section');

        const hideAllTiers = () => {
          if (championsSection) championsSection.hidden = true;
          if (sponsorsSection) sponsorsSection.hidden = true;
          if (backersSection) backersSection.hidden = true;
          if (supportersSection) supportersSection.hidden = true;

          if (championsGrid) championsGrid.innerHTML = '';
          if (sponsorsGrid) sponsorsGrid.innerHTML = '';
          if (backersGrid) backersGrid.innerHTML = '';
          if (supportersGrid) supportersGrid.innerHTML = '';
        };

        const showSponsorWall = (sponsors) => {
          const list = Array.isArray(sponsors) ? sponsors : [];
          if (!list.length) {
            if (sponsorsSubtitle) {
              sponsorsSubtitle.textContent = 'New sponsors will appear here.';
            }
            if (sponsorsEmpty) sponsorsEmpty.hidden = false;
            hideAllTiers();
            return;
          }

          if (sponsorsSubtitle) {
            sponsorsSubtitle.textContent =
              'From all of us Polar users, thank you for supporting its ongoing development. Your generosity keeps the project moving forward and helps the whole Lightning community build.';
          }

          if (sponsorsEmpty) sponsorsEmpty.hidden = true;

          const champions = list.filter((s) => s?.tier === 'champion');
          const sponsorsTier = list.filter((s) => s?.tier === 'sponsor');
          const backers = list.filter((s) => s?.tier === 'backer');
          const supporters = list.filter((s) => s?.tier === 'supporter');

          if (championsSection)
            championsSection.hidden = champions.length === 0;
          if (sponsorsSection)
            sponsorsSection.hidden = sponsorsTier.length === 0;
          if (backersSection) backersSection.hidden = backers.length === 0;
          if (supportersSection)
            supportersSection.hidden = supporters.length === 0;

          renderSponsorTier(championsGrid, list, 'champion', true);
          renderSponsorTier(sponsorsGrid, list, 'sponsor', false);
          renderSponsorTier(backersGrid, list, 'backer', false);
          renderSponsorTier(supportersGrid, list, 'supporter', false);
        };

        // Default UI while loading (and if API is unavailable)
        if (sponsorsEmpty) sponsorsEmpty.hidden = false;
        hideAllTiers();

        fetchSponsors()
          .then((sponsors) => {
            showSponsorWall(sponsors);
          })
          .catch(() => {
            // If the API is unavailable, still show the empty state.
            if (sponsorsEmpty) sponsorsEmpty.hidden = false;
            hideAllTiers();
          });
      })();
    </script>
  </body>
</html>
