<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="jamaljsr" />
    <meta
      name="description"
      content="Donate to Polar to help builders ship Lightning apps faster. Choose a tier, add your handle (optional), and donate with Lightning or Bitcoin."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Donate to Polar</title>

    <link
      rel="shortcut icon"
      href="../images/favicon.ico"
      type="image/x-icon"
    />
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png" />

    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Noto+Sans+TC:300,400,500,700,900"
      rel="stylesheet"
    />

    <link href="../css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link href="../css/flaticon.css" rel="stylesheet" />
    <link href="../css/magnific-popup.css" rel="stylesheet" />
    <link href="../css/owl.carousel.min.css" rel="stylesheet" />
    <link href="../css/owl.theme.default.min.css" rel="stylesheet" />
    <link href="../css/animate.css" rel="stylesheet" />
    <link href="../css/main.css" rel="stylesheet" />
    <link href="../css/responsive.css" rel="stylesheet" />
  </head>

  <body class="donate-page">
    <div id="page" class="page">
      <!-- HEADER -->
      <header id="header" class="header">
        <nav
          class="navbar fixed-top navbar-expand-md navbar-light bg-tra hover-menu donate-nav"
        >
          <div class="container">
            <a href="../index.html#hero-2" class="navbar-brand logo-black">
              <img
                src="../images/logo.png"
                width="120"
                height="30"
                alt="Polar logo"
              />
            </a>

            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-bar-icon"><i class="fas fa-bars"></i></span>
            </button>

            <div id="navbarSupportedContent" class="collapse navbar-collapse">
              <ul class="navbar-nav ml-auto">
                <li class="nav-item nl-simple">
                  <a class="nav-link" href="../index.html#hero-2">Home</a>
                </li>
                <li class="nav-item nl-simple">
                  <a class="nav-link" href="../index.html#content-1"
                    >Features</a
                  >
                </li>
                <li class="nav-item nl-simple">
                  <a class="nav-link" href="../index.html#reviews-2">Reviews</a>
                </li>
                <li class="nav-item nl-simple active">
                  <a class="nav-link" href="/donate/">Donate</a>
                </li>
              </ul>

              <span class="navbar-text white-color">
                <a
                  href="../index.html#hero-2"
                  class="btn btn-primary-color tra-black-hover"
                  >Download</a
                >
              </span>
            </div>
          </div>
        </nav>
      </header>
      <!-- END HEADER -->

      <!-- HERO -->
      <section id="donate-hero" class="bg-lightgrey">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-6">
              <div class="hero-txt">
                <h1 class="h2-sm steelblue-color">Support the Polar project</h1>
                <p class="p-md">
                  Polar stays fast and free thanks to the contributions from the
                  community. Thank you for helping builders ship Lightning apps
                  faster. If youâ€™d like to join them, add your handle and weâ€™ll
                  direct you to a quick, built-in payment page for a Lightning
                  or on-chain donation.
                </p>
                <div class="hero-benefits-wrap">
                  <ul class="hero-benefits">
                    <li>
                      Every supporter appears in the Supporters list by tier
                    </li>
                    <li>
                      Accepts Bitcoin, Lightning, and USD via GitHub Sponsors
                    </li>
                    <li>GitHub, Twitter, or Nostr handles for recognition</li>
                    <li>Code contributors recognized for their work</li>
                  </ul>
                </div>
                <a
                  class="btn btn-primary-color tra-black-hover"
                  href="#donate-flow"
                  >Donate BTC</a
                >
                <a
                  class="btn btn-outline-secondary d-inline-block ml-2"
                  href="https://github.com/sponsors/jamaljsr"
                  target="_blank"
                  rel="noopener"
                  >Donate USD</a
                >
                <p class="mt-2 mb-0 grey-color">
                  Prefer to contribute code? Visit the
                  <a
                    href="https://github.com/jamaljsr/polar"
                    target="_blank"
                    rel="noopener"
                    >Polar repo</a
                  >.
                </p>
              </div>
            </div>
            <div class="col-lg-5 offset-lg-1">
              <div class="donate-hero-card">
                <div class="donate-hero-label">Bitcoin + Lightning</div>
                <h4 class="h4-sm mt-10">
                  Fuel development, testing, and support
                </h4>
                <p class="mb-0">
                  Donations fund: faster releases, updated node images, docs,
                  and community help for Lightning builders.
                </p>
                <div class="donate-hero-meta mt-20">
                  <div>
                    <span class="meta-label">Recognition</span>
                    <p class="mb-0">On this page and homepage</p>
                  </div>
                  <div>
                    <span class="meta-label">Payments</span>
                    <p class="mb-0">Bitcoin, Lightning, and USD</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- END HERO -->

      <!-- DONATE FLOW -->
      <section
        id="donate-flow"
        class="wide-80 donate-flow division bg-white b-top"
      >
        <div class="container">
          <div class="row">
            <div class="col-lg-6">
              <div class="section-title mb-30">
                <h3 class="h3-md steelblue-color">Pick a Tier</h3>
                <p class="p-md">
                  Custom amounts map to the closest tier automatically.
                </p>
              </div>
              <div class="tier-grid">
                <div class="tier-card active" data-tier="sparks">
                  <div class="tier-label">Sparks</div>
                  <p class="tier-amount">100K sats</p>
                  <p class="tier-copy mb-0">Ignite growth.</p>
                </div>
                <div class="tier-card" data-tier="bolts">
                  <div class="tier-label">Bolts</div>
                  <p class="tier-amount">500K sats</p>
                  <p class="tier-copy mb-0">Supercharge development.</p>
                </div>
                <div class="tier-card" data-tier="ion_drivers">
                  <div class="tier-label">Ion Drivers</div>
                  <p class="tier-amount">1M sats</p>
                  <p class="tier-copy mb-0">Drive scaling.</p>
                </div>
                <div class="tier-card" data-tier="critical_mass">
                  <div class="tier-label">Critical Mass</div>
                  <p class="tier-amount">10M+ sats</p>
                  <p class="tier-copy mb-0">Unleash full impact.</p>
                </div>
              </div>
            </div>

            <div class="col-lg-5 offset-lg-1">
              <div class="contribute-card">
                <div class="contribute-card-header">
                  <h4 class="h4-sm mb-2">One-time BTC Donation</h4>
                  <p class="mb-0">
                    You'll be redirected to our payment page to obtain a
                    Lightning invoice or Bitcoin on-chain address.
                  </p>
                </div>

                <div class="form-group amount-group">
                  <label for="sats-amount">Amount</label>
                  <div class="input-group input-group-lg">
                    <input
                      id="sats-amount"
                      type="text"
                      inputmode="numeric"
                      class="form-control"
                      value="100,000"
                    />
                    <div class="input-group-append">
                      <span class="input-group-text">sats</span>
                    </div>
                  </div>
                </div>

                <div class="form-group recognition-group">
                  <div class="custom-control custom-switch recognition-toggle">
                    <input
                      type="checkbox"
                      class="custom-control-input"
                      id="recognition-enabled"
                    />
                    <label
                      class="custom-control-label"
                      for="recognition-enabled"
                      >Add me to the Supporters list
                    </label>
                  </div>
                </div>

                <div id="recognition-fields" class="recognition-fields" hidden>
                  <div class="form-group">
                    <label>Platform</label>
                    <div class="btn-group platform-toggle" role="group">
                      <button
                        type="button"
                        class="btn btn-outline-secondary active"
                        data-platform="github"
                      >
                        GitHub
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        data-platform="twitter"
                      >
                        Twitter / X
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        data-platform="nostr"
                      >
                        Nostr
                      </button>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="username">Handle</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="platform-prefix"
                          >@</span
                        >
                      </div>
                      <input
                        id="username"
                        type="text"
                        class="form-control"
                        placeholder="username"
                        aria-describedby="platform-prefix"
                      />
                    </div>
                    <small class="form-text text-muted">
                      Shown publicly in the Supporters list.
                    </small>
                  </div>
                </div>

                <div class="contribute-actions">
                  <a
                    id="pay-button"
                    class="btn btn-primary-color tra-black-hover btn-wide"
                    href="#"
                    >Donate</a
                  >
                </div>
                <p id="donation-error" class="text-danger mt-2 mb-0" hidden></p>

                <p class="form-note mb-0 grey-color">
                  After confirming payment, we'll add you to the matching tier
                  on this page and highlight top supporters on the homepage.
                </p>

                <p class="form-note mt-10 grey-color">
                  Prefer fiat? Use the
                  <a
                    href="https://github.com/sponsors/jamaljsr"
                    target="_blank"
                    rel="noopener"
                    >GitHub Sponsors</a
                  >
                  page.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- END DONATE FLOW -->

      <!-- SUPPORTERS LISTS -->
      <section id="supporters-lists" class="wide-80 supporters-lists division">
        <div class="container">
          <div class="row">
            <div class="col-lg-10 offset-lg-1 section-title">
              <h3 class="h3-md steelblue-color">
                Supporters &amp; Contributors
              </h3>
              <p class="p-md">
                Huge thanks to everyone helping Polar run. Supporters and
                contributors are recognized below.
              </p>
            </div>
          </div>

          <div class="supporter-level">
            <div class="supporter-level-header">
              <h4 class="h4-sm mb-1">Supporters</h4>
              <p id="supporters-subtitle" class="mb-0">
                New supporters will appear here.
              </p>
            </div>
            <div class="supporter-level-body">
              <div id="supporters-empty" class="row">
                <div class="col-lg-8">
                  <div class="supporter-empty">
                    <div class="supporter-empty-icon" aria-hidden="true">
                      <i class="fas fa-star"></i>
                    </div>
                    <div class="supporter-empty-body">
                      <div class="supporter-name">No supporters yet</div>
                      <p class="supporter-note mb-2">
                        Be the first supporter and help fund Polarâ€™s roadmap.
                      </p>
                      <a
                        class="btn btn-primary-color tra-black-hover btn-sm"
                        href="#donate-flow"
                        >Donate now</a
                      >
                    </div>
                  </div>
                </div>
              </div>

              <div class="supporter-tiers">
                <div
                  id="critical-mass-section"
                  class="supporter-tier tier-critical_mass"
                  hidden
                >
                  <div class="supporter-tier-header">
                    <div class="supporter-tier-pill">Critical Mass</div>
                    <div class="supporter-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="critical-mass-grid" class="supporter-grid"></div>
                </div>

                <div
                  id="ion-drivers-section"
                  class="supporter-tier tier-ion_drivers"
                  hidden
                >
                  <div class="supporter-tier-header">
                    <div class="supporter-tier-pill">Ion Drivers</div>
                    <div class="supporter-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="ion-drivers-grid" class="supporter-grid"></div>
                </div>

                <div
                  id="bolts-section"
                  class="supporter-tier tier-bolts"
                  hidden
                >
                  <div class="supporter-tier-header">
                    <div class="supporter-tier-pill">Bolts</div>
                    <div class="supporter-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="bolts-grid" class="supporter-grid"></div>
                </div>

                <div
                  id="sparks-section"
                  class="supporter-tier tier-sparks"
                  hidden
                >
                  <div class="supporter-tier-header">
                    <div class="supporter-tier-pill">Sparks</div>
                    <div class="supporter-tier-accent" aria-hidden="true"></div>
                  </div>
                  <div id="sparks-grid" class="supporter-grid"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="supporter-level">
            <div class="supporter-level-header">
              <h4 class="h4-sm mb-1">Contributors</h4>
              <p class="mb-3">
                Recognizing contributors whose code keeps Polar fast, stable,
                and useful for the Lightning community.
              </p>
            </div>
            <div id="contributors-list" class="row contributor-grid"></div>
          </div>
        </div>
      </section>
      <!-- END SUPPORTERS LISTS -->
    </div>
    <!-- END PAGE -->

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jquery.easing.js"></script>
    <script src="../js/wow.js"></script>
    <script src="../js/custom.js?v3.3.0"></script>
    <script>
      new WOW().init();
    </script>
    <script>
      (() => {
        const tierMinimums = {
          sparks: 100000,
          bolts: 500000,
          ion_drivers: 1000000,
          critical_mass: 10000000,
        };

        const platformPlaceholders = {
          github: 'username',
          twitter: 'handle',
          nostr: 'npub1...',
        };

        const tierCards = document.querySelectorAll('.tier-card');
        const amountInput = document.getElementById('sats-amount');
        const platformButtons = document.querySelectorAll('[data-platform]');
        const platformPrefix = document.getElementById('platform-prefix');
        const usernameInput = document.getElementById('username');
        const payButton = document.getElementById('pay-button');
        const recognitionToggle = document.getElementById(
          'recognition-enabled'
        );
        const recognitionFields = document.getElementById('recognition-fields');
        const donationError = document.getElementById('donation-error');
        const contributorsList = document.getElementById('contributors-list');

        let selectedTier = 'sparks';
        let selectedPlatform = 'github';
        const apiParam = new URLSearchParams(window.location.search).get('api');
        const apiPort = '8787';
        const host = window.location.hostname;
        const isProdSite =
          host === 'lightningpolar.com' || host.endsWith('.lightningpolar.com');
        const apiBase =
          apiParam ||
          (isProdSite
            ? 'https://api.lightningpolar.com'
            : `${window.location.protocol}//${host}:${apiPort}`);

        const tierDisplayName = (tier) => {
          const value = String(tier || '').trim();
          if (!value) return '';
          if (value === 'critical_mass') return 'Critical Mass';
          if (value === 'ion_drivers') return 'Ion Drivers';
          if (value === 'bolts') return 'Bolts';
          if (value === 'sparks') return 'Sparks';
          return value
            .split(/[_-]/g)
            .filter(Boolean)
            .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
            .join(' ');
        };

        const contributors = [
          {
            name: 'kelvinator07',
            url: 'https://github.com/kelvinator07',
            avatar: 'https://avatars.githubusercontent.com/u/37830553?v=4',
            year: '2024',
          },
          {
            name: 'Abdulkbk',
            url: 'https://github.com/Abdulkbk',
            avatar: 'https://avatars.githubusercontent.com/u/45062451?v=4',
            year: '2025',
          },
          {
            name: 'bolatovumar',
            url: 'https://github.com/bolatovumar',
            avatar: 'https://avatars.githubusercontent.com/u/1934678?v=4',
            year: '2021',
          },
          {
            name: 'Jem256',
            url: 'https://github.com/Jem256',
            avatar: 'https://avatars.githubusercontent.com/u/72874905?v=4',
            year: '2025',
          },
          {
            name: 'amovfx',
            url: 'https://github.com/amovfx',
            avatar: 'https://avatars.githubusercontent.com/u/45839100?v=4',
            year: '2023',
          },
          {
            name: 'torkelrogstad',
            url: 'https://github.com/torkelrogstad',
            avatar: 'https://avatars.githubusercontent.com/u/16610775?v=4',
            year: '2020',
          },
          {
            name: 'louneskmt',
            url: 'https://github.com/louneskmt',
            avatar: 'https://avatars.githubusercontent.com/u/38882571?v=4',
            year: '2022',
          },
          {
            name: 'ktecho',
            url: 'https://github.com/ktecho',
            avatar: 'https://avatars.githubusercontent.com/u/547169?v=4',
            year: '2022',
          },
          {
            name: 'uwla',
            url: 'https://github.com/uwla',
            avatar: 'https://avatars.githubusercontent.com/u/47862859?v=4',
            year: '2024',
          },
          {
            name: 'murtyjones',
            url: 'https://github.com/murtyjones',
            avatar: 'https://avatars.githubusercontent.com/u/708562?v=4',
            year: '2021',
          },
          {
            name: 'hsjoberg',
            url: 'https://github.com/hsjoberg',
            avatar: 'https://avatars.githubusercontent.com/u/3824379?v=4',
            year: '2022',
          },
          {
            name: 'Hakkadaikon',
            url: 'https://github.com/Hakkadaikon',
            avatar: 'https://avatars.githubusercontent.com/u/57866935?v=4',
            year: '2024',
          },
          {
            name: 'IgnacioPorte',
            url: 'https://github.com/IgnacioPorte',
            avatar: 'https://avatars.githubusercontent.com/u/62029630?v=4',
            year: '2025',
          },
          {
            name: 'porcupinenick',
            url: 'https://github.com/porcupinenick',
            avatar: 'https://avatars.githubusercontent.com/u/24903257?v=4',
            year: '2020',
          },
          {
            name: 'niteshbalusu11',
            url: 'https://github.com/niteshbalusu11',
            avatar: 'https://avatars.githubusercontent.com/u/84944042?v=4',
            year: '2022',
          },
          {
            name: 'hieblmi',
            url: 'https://github.com/hieblmi',
            avatar: 'https://avatars.githubusercontent.com/u/18631614?v=4',
            year: '2023',
          },
          {
            name: 'AdamuAbba',
            url: 'https://github.com/AdamuAbba',
            avatar: 'https://avatars.githubusercontent.com/u/48435816?v=4',
            year: '2025',
          },
          {
            name: 'cstenglein',
            url: 'https://github.com/cstenglein',
            avatar: 'https://avatars.githubusercontent.com/u/9399034?v=4',
            year: '2021',
          },
          {
            name: 'kaloudis',
            url: 'https://github.com/kaloudis',
            avatar: 'https://avatars.githubusercontent.com/u/1878621?v=4',
            year: '2020',
          },
          {
            name: 'federicobond',
            url: 'https://github.com/federicobond',
            avatar: 'https://avatars.githubusercontent.com/u/138426?v=4',
            year: '2019',
          },
          {
            name: 'Fideltodayy',
            url: 'https://github.com/Fideltodayy',
            avatar: 'https://avatars.githubusercontent.com/u/113513351?v=4',
            year: '2025',
          },
          {
            name: 'qustavo',
            url: 'https://github.com/qustavo',
            avatar: 'https://avatars.githubusercontent.com/u/1288313?v=4',
            year: '2021',
          },
          {
            name: 'NonsoAmadi10',
            url: 'https://github.com/NonsoAmadi10',
            avatar: 'https://avatars.githubusercontent.com/u/42790057?v=4',
            year: '2023',
          },
          {
            name: 'jcbrand',
            url: 'https://github.com/jcbrand',
            avatar: 'https://avatars.githubusercontent.com/u/683911?v=4',
            year: '2025',
          },
          {
            name: 'Jasonvdb',
            url: 'https://github.com/Jasonvdb',
            avatar: 'https://avatars.githubusercontent.com/u/5300488?v=4',
            year: '2020',
          },
          {
            name: 'halseth',
            url: 'https://github.com/halseth',
            avatar: 'https://avatars.githubusercontent.com/u/3765732?v=4',
            year: '2020',
          },
          {
            name: 'Jhoyola',
            url: 'https://github.com/Jhoyola',
            avatar: 'https://avatars.githubusercontent.com/u/42843554?v=4',
            year: '2023',
          },
          {
            name: 'lukechilds',
            url: 'https://github.com/lukechilds',
            avatar: 'https://avatars.githubusercontent.com/u/2123375?v=4',
            year: '2020',
          },
          {
            name: 'Mshehu5',
            url: 'https://github.com/Mshehu5',
            avatar: 'https://avatars.githubusercontent.com/u/104724920?v=4',
            year: '2025',
          },
          {
            name: 'NehaK745',
            url: 'https://github.com/NehaK745',
            avatar: 'https://avatars.githubusercontent.com/u/64440607?v=4',
            year: '2021',
          },
          {
            name: 'ottosuess',
            url: 'https://github.com/ottosuess',
            avatar: 'https://avatars.githubusercontent.com/u/37940680?v=4',
            year: '2019',
          },
          {
            name: 'SeverinAlexB',
            url: 'https://github.com/SeverinAlexB',
            avatar: 'https://avatars.githubusercontent.com/u/8782386?v=4',
            year: '2023',
          },
          {
            name: 'valentinewallace',
            url: 'https://github.com/valentinewallace',
            avatar: 'https://avatars.githubusercontent.com/u/10647624?v=4',
            year: '2021',
          },
          {
            name: 'wbobeirne',
            url: 'https://github.com/wbobeirne',
            avatar: 'https://avatars.githubusercontent.com/u/649992?v=4',
            year: '2019',
          },
          {
            name: 'ramigs',
            url: 'https://github.com/ramigs',
            avatar: 'https://avatars.githubusercontent.com/u/44037130?v=4',
            year: '2023',
          },
          {
            name: 'git-sgmoore',
            url: 'https://github.com/git-sgmoore',
            avatar: 'https://avatars.githubusercontent.com/u/24982751?v=4',
            year: '2021',
          },
          {
            name: 'soonsouth',
            url: 'https://github.com/soonsouth',
            avatar: 'https://avatars.githubusercontent.com/u/163404563?v=4',
            year: '2024',
          },
          {
            name: 'zackypick',
            url: 'https://github.com/zackypick',
            avatar: 'https://avatars.githubusercontent.com/u/15138241?v=4',
            year: '2022',
          },
          {
            name: 'See all contributors',
            role: 'Add your name to the list',
            url: 'https://github.com/jamaljsr/polar/graphs/contributors',
            cta: true,
          },
        ];

        const setPayButtonEnabled = (enabled) => {
          if (!payButton) return;
          const isEnabled = Boolean(enabled);
          payButton.classList.toggle('disabled', !isEnabled);
          if (isEnabled) {
            payButton.removeAttribute('aria-disabled');
          } else {
            payButton.setAttribute('aria-disabled', 'true');
          }
        };

        const formatAmount = (value) =>
          Number(value).toLocaleString('en-US', { maximumFractionDigits: 0 });

        const parseAmountSat = (rawValue) => {
          const raw = String(rawValue ?? '').trim();
          const cleaned = raw.replace(/[,\s]/g, '');

          if (!cleaned) {
            return { ok: false, error: 'Enter an amount in sats.' };
          }
          if (!/^\d+$/.test(cleaned)) {
            return { ok: false, error: 'Amount must be a whole number.' };
          }

          const amountSat = Number(cleaned);
          if (!Number.isSafeInteger(amountSat)) {
            return { ok: false, error: 'Amount is too large.' };
          }
          if (amountSat <= 0) {
            return { ok: false, error: 'Amount must be at least 1,000 sats.' };
          }
          if (amountSat < 1000) {
            return {
              ok: false,
              error: 'Amount must be at least 1,000 sats.',
            };
          }

          return { ok: true, amountSat };
        };

        const clearTierSelection = () => {
          selectedTier = null;
          tierCards.forEach((card) => card.classList.remove('active'));
        };

        const matchTierForAmount = (amountSat) => {
          if (amountSat < tierMinimums.sparks) return null;
          const tiers = Object.keys(tierMinimums);
          let matchedTier = tiers[0];
          tiers.forEach((tier) => {
            if (amountSat >= tierMinimums[tier]) matchedTier = tier;
          });
          return matchedTier;
        };

        const updateTierFromAmountOnBlur = () => {
          const parsed = parseAmountSat(amountInput?.value);
          if (!parsed.ok) {
            showError(parsed.error);
            setPayButtonEnabled(false);
            return null;
          }

          showError('');
          setPayButtonEnabled(true);

          const matchedTier = matchTierForAmount(parsed.amountSat);
          if (!matchedTier) {
            clearTierSelection();
          } else {
            selectedTier = matchedTier;
            tierCards.forEach((card) =>
              card.classList.toggle('active', card.dataset.tier === matchedTier)
            );
          }

          amountInput.value = formatAmount(parsed.amountSat);
          return parsed.amountSat;
        };

        const setTier = (tier) => {
          selectedTier = tier;
          const min = tierMinimums[tier];
          amountInput.value = formatAmount(min);

          tierCards.forEach((card) =>
            card.classList.toggle('active', card.dataset.tier === tier)
          );

          showError('');
          setPayButtonEnabled(true);
        };

        const setPlatform = (platform) => {
          selectedPlatform = platform;
          platformButtons.forEach((btn) =>
            btn.classList.toggle('active', btn.dataset.platform === platform)
          );
          platformPrefix.textContent = platform === 'nostr' ? 'ðŸ”‘' : '@';
          usernameInput.placeholder = platformPlaceholders[platform];
        };

        const showError = (message) => {
          if (!donationError) return;
          donationError.hidden = !message;
          donationError.textContent = message || '';
        };

        const createDonation = async (includeIdentity = true) => {
          const parsed = parseAmountSat(amountInput?.value);
          if (!parsed.ok) {
            showError(parsed.error);
            setPayButtonEnabled(false);
            throw new Error(parsed.error);
          }
          const amountSat = parsed.amountSat;
          const matchedTier = matchTierForAmount(amountSat);
          if (!matchedTier) {
            clearTierSelection();
          } else {
            selectedTier = matchedTier;
            tierCards.forEach((card) =>
              card.classList.toggle('active', card.dataset.tier === matchedTier)
            );
          }
          amountInput.value = formatAmount(amountSat);
          showError('');
          setPayButtonEnabled(true);

          const username = usernameInput.value.trim();

          const payload = { amountSat };
          if (includeIdentity && username) {
            payload.platform = selectedPlatform;
            payload.username = username;
          }

          const res = await fetch(`${apiBase}/donations`, {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify(payload),
          });

          const data = await res.json().catch(() => null);
          if (!res.ok) {
            throw new Error(data?.error?.message || 'Unable to start payment.');
          }

          if (!data?.donationId) {
            throw new Error('Unexpected response from server.');
          }

          return data.donationId;
        };

        const fetchSupporters = async () => {
          const res = await fetch(`${apiBase}/supporters`, { method: 'GET' });
          if (!res.ok) return [];
          const data = await res.json().catch(() => null);
          return Array.isArray(data?.supporters) ? data.supporters : [];
        };

        const safeUrl = (value) => {
          try {
            const u = new URL(value);
            return u.protocol === 'https:' ? u.toString() : null;
          } catch {
            return null;
          }
        };

        const labelFromProfile = (profileUrl) => {
          try {
            const u = new URL(profileUrl);
            const last =
              u.pathname.split('/').filter(Boolean).pop() || u.hostname;
            return last.length > 22 ? `${last.slice(0, 22)}â€¦` : last;
          } catch {
            return 'Supporter';
          }
        };

        const displayNameForSupporter = (supporter) => {
          const username =
            supporter && typeof supporter.username === 'string'
              ? supporter.username.trim()
              : '';
          if (username) {
            return username.length > 22
              ? `${username.slice(0, 22)}â€¦`
              : username;
          }

          const profileUrl = supporter?.profileUrl;
          return typeof profileUrl === 'string'
            ? labelFromProfile(profileUrl)
            : 'Supporter';
        };

        const renderSupporterTier = (
          gridEl,
          supporters,
          tier,
          isChampion = false
        ) => {
          if (!gridEl) return;
          gridEl.innerHTML = '';

          const tierSupporters = supporters.filter((s) => s?.tier === tier);
          if (!tierSupporters.length) return;

          tierSupporters.forEach((s) => {
            const profileUrl = safeUrl(s.profileUrl);
            const imageUrl = safeUrl(s.imageUrl);
            if (!profileUrl || !imageUrl) return;

            const tile = document.createElement('a');
            tile.className = `supporter-tile tier-${tier}`;
            tile.href = profileUrl;
            tile.target = '_blank';
            tile.rel = 'noopener noreferrer';

            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = `${displayNameForSupporter(s)} avatar`;
            img.loading = 'lazy';
            img.referrerPolicy = 'no-referrer';

            const avatar = document.createElement('div');
            avatar.className = 'supporter-avatar';

            const avatarInner = document.createElement('div');
            avatarInner.className = 'supporter-avatar-inner';
            avatarInner.appendChild(img);
            avatar.appendChild(avatarInner);

            const namePill = document.createElement('div');
            namePill.className = 'supporter-name-pill';
            namePill.textContent = displayNameForSupporter(s);

            avatar.appendChild(namePill);

            tile.appendChild(avatar);

            gridEl.appendChild(tile);
          });
        };

        const renderContributors = () => {
          if (!contributorsList) return;

          contributorsList.innerHTML = '';

          contributors.forEach(({ name, role, url, avatar, year, cta }) => {
            const col = document.createElement('div');
            col.className = 'col-6 col-lg-4';

            const tile = document.createElement(url ? 'a' : 'div');
            tile.className = `contributor-tile${cta ? ' cta' : ''}`;

            if (url) {
              tile.href = url;
              tile.target = '_blank';
              tile.rel = 'noopener';
            }

            const avatarEl = document.createElement('div');
            avatarEl.className = 'contributor-avatar';
            if (!cta && avatar) {
              const img = document.createElement('img');
              img.src = avatar;
              img.alt = `${name} avatar`;
              img.loading = 'lazy';
              img.referrerPolicy = 'no-referrer';
              img.onerror = () => {
                avatarEl.textContent = (name || '?').charAt(0).toUpperCase();
                img.remove();
              };
              avatarEl.appendChild(img);
            } else {
              avatarEl.textContent = (name || '?').charAt(0).toUpperCase();
            }

            const meta = document.createElement('div');

            const title = document.createElement('div');
            title.className = 'contributor-name';
            title.textContent = name;

            const subtitle = document.createElement('p');
            subtitle.className = 'contributor-role mb-0';
            subtitle.textContent = year
              ? `${year} ${role || 'Contributor'}`
              : role || 'Contributor';

            meta.appendChild(title);
            meta.appendChild(subtitle);

            tile.appendChild(avatarEl);
            tile.appendChild(meta);
            col.appendChild(tile);
            contributorsList.appendChild(col);
          });
        };

        tierCards.forEach((card) => {
          card.addEventListener('click', () => setTier(card.dataset.tier));
        });

        platformButtons.forEach((btn) => {
          btn.addEventListener('click', () =>
            setPlatform(btn.dataset.platform)
          );
        });

        amountInput.addEventListener('focus', () => {
          showError('');
          setPayButtonEnabled(true);
          amountInput.value = String(amountInput.value).replace(/,/g, '');
        });

        amountInput.addEventListener('blur', () => {
          updateTierFromAmountOnBlur();
        });

        amountInput.addEventListener('input', () => {
          showError('');
          setPayButtonEnabled(true);
        });

        const updateRecognitionUI = () => {
          const enabled = Boolean(recognitionToggle?.checked);
          if (recognitionFields) recognitionFields.hidden = !enabled;
          if (!enabled && usernameInput) usernameInput.value = '';
        };

        recognitionToggle?.addEventListener('change', updateRecognitionUI);

        payButton.addEventListener('click', (event) => {
          event.preventDefault();
          showError('');

          // Block donation if the amount is invalid (even if the user never blurs).
          const parsed = parseAmountSat(amountInput?.value);
          if (!parsed.ok) {
            showError(parsed.error);
            return;
          }

          setPayButtonEnabled(false);

          createDonation(Boolean(recognitionToggle?.checked))
            .then((donationId) => {
              window.location.href = `/donate/pay/?donation=${encodeURIComponent(
                donationId
              )}`;
            })
            .catch((err) => {
              showError(err instanceof Error ? err.message : String(err));
              setPayButtonEnabled(true);
            });
        });

        // Initialize defaults
        setTier('sparks');
        setPlatform(selectedPlatform);
        updateRecognitionUI();
        renderContributors();

        // Render Supporters list from API (paid + published only)
        const criticalMassGrid = document.getElementById('critical-mass-grid');
        const ionDriversGrid = document.getElementById('ion-drivers-grid');
        const boltsGrid = document.getElementById('bolts-grid');
        const sparksGrid = document.getElementById('sparks-grid');

        const supportersSubtitle = document.getElementById(
          'supporters-subtitle'
        );

        const supportersEmpty = document.getElementById('supporters-empty');
        const criticalMassSection = document.getElementById(
          'critical-mass-section'
        );
        const ionDriversSection = document.getElementById(
          'ion-drivers-section'
        );
        const boltsSection = document.getElementById('bolts-section');
        const sparksSection = document.getElementById('sparks-section');

        const hideAllTiers = () => {
          if (criticalMassSection) criticalMassSection.hidden = true;
          if (ionDriversSection) ionDriversSection.hidden = true;
          if (boltsSection) boltsSection.hidden = true;
          if (sparksSection) sparksSection.hidden = true;

          if (criticalMassGrid) criticalMassGrid.innerHTML = '';
          if (ionDriversGrid) ionDriversGrid.innerHTML = '';
          if (boltsGrid) boltsGrid.innerHTML = '';
          if (sparksGrid) sparksGrid.innerHTML = '';
        };

        const showSupporters = (supporters) => {
          const list = Array.isArray(supporters) ? supporters : [];
          if (!list.length) {
            if (supportersSubtitle) {
              supportersSubtitle.textContent =
                'New supporters will appear here.';
            }
            if (supportersEmpty) supportersEmpty.hidden = false;
            hideAllTiers();
            return;
          }

          if (supportersSubtitle) {
            supportersSubtitle.textContent =
              'From all of us Polar users, thank you for supporting its ongoing development. Your generosity keeps the project moving forward and helps the whole Lightning community build.';
          }

          if (supportersEmpty) supportersEmpty.hidden = true;

          const criticalMass = list.filter((s) => s?.tier === 'critical_mass');
          const ionDrivers = list.filter((s) => s?.tier === 'ion_drivers');
          const bolts = list.filter((s) => s?.tier === 'bolts');
          const sparks = list.filter((s) => s?.tier === 'sparks');

          if (criticalMassSection)
            criticalMassSection.hidden = criticalMass.length === 0;
          if (ionDriversSection)
            ionDriversSection.hidden = ionDrivers.length === 0;
          if (boltsSection) boltsSection.hidden = bolts.length === 0;
          if (sparksSection) sparksSection.hidden = sparks.length === 0;

          renderSupporterTier(criticalMassGrid, list, 'critical_mass', true);
          renderSupporterTier(ionDriversGrid, list, 'ion_drivers', false);
          renderSupporterTier(boltsGrid, list, 'bolts', false);
          renderSupporterTier(sparksGrid, list, 'sparks', false);
        };

        // Default UI while loading (and if API is unavailable)
        if (supportersEmpty) supportersEmpty.hidden = false;
        hideAllTiers();

        fetchSupporters()
          .then((supporters) => {
            showSupporters(supporters);
          })
          .catch(() => {
            // If the API is unavailable, still show the empty state.
            if (supportersEmpty) supportersEmpty.hidden = false;
            hideAllTiers();
          });
      })();
    </script>
  </body>
</html>
